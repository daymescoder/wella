!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.RenderExtensionLoader=e()}(this,function(){"use strict";var t=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t};function e(t,e,n,i){return new(n||(n=Promise))(function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function u(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,u)}c((i=i.apply(t,e||[])).next())})}function n(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=i[2&o[0]?"return":o[0]?"throw":"next"])&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[0,r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}return function(){return function(i){var r=this,o=i.account,s=i.workspace,u=i.path,c=i.locale,a=i.publicEndpoint,l=i.verbose,d=i.timeout;if(this.getRuntimeContext=function(){return e(r,void 0,void 0,function(){return n(this,function(t){switch(t.label){case 0:return this.runtime?[3,2]:[4,this.loadExtensionPointsContext()];case 1:t.sent(),t.label=2;case 2:return[2,{runtime:this.runtime,scripts:this.scripts,styles:this.styles}]}})})},this.load=function(){return e(r,void 0,void 0,function(){return n(this,function(t){switch(t.label){case 0:return this.runtime?[3,2]:[4,this.loadExtensionPointsContext()];case 1:t.sent(),t.label=2;case 2:return this.styles&&this.styles.forEach(this.addStyleToPage),this.time("render-extension-loader:scripts"),[4,Promise.all(this.scripts.map(this.addScriptToPage))];case 3:return t.sent(),this.timeEnd("render-extension-loader:scripts"),[2,this.runtime]}})})},this.update=function(e){return r.runtime="function"==typeof e?e(r.runtime):t(t({},r.runtime),e),r.runtime},this.render=function(e,n,i){return i&&(r.runtime.extensions[e].props=t(t({},r.runtime.extensions[e].props),i)),r.time("render-extension-loader:render"),window["__RENDER_"+r.renderMajor+"_RUNTIME__"].render(e,r.runtime,n),r.timeEnd("render-extension-loader:render"),r.runtime},this.loadExtensionPointsContext=function(){return e(r,void 0,void 0,function(){var t,e,i,r,o;return n(this,function(n){switch(n.label){case 0:return this.time("render-extension-loader:json"),[4,this.get("https://"+this.workspace+"--"+this.account+"."+this.publicEndpoint+"/legacy-extensions"+this.path+"?__disableSSR&locale="+this.locale+"&v=3&origin="+window.location.hostname)];case 1:for(o in t=n.sent(),e=t.runtime,i=t.styles,r=t.scripts,this.timeEnd("render-extension-loader:json"),window.__RUNTIME__||{})Object.prototype.hasOwnProperty.call(window.__RUNTIME__,o)&&void 0===e[o]&&(e[o]=window.__RUNTIME__[o]);return this.setGlobalContext({runtime:e,styles:i,scripts:r}),[2,{runtime:e,styles:i,scripts:r}]}})})},this.setGlobalContext=function(e){var n=e.runtime,i=e.styles,o=e.scripts;r.renderMajor=n.renderMajor||6,r.styles=i,r.scripts=o,r.runtime=t(t({},n),{start:!1})},this.getExistingScriptSrcs=function(){for(var t=[],e=0;e<document.scripts.length;e++)t.push(document.scripts.item(e).src);return t},this.scriptOnPage=function(t){return r.getExistingScriptSrcs().some(function(e){return-1!==e.indexOf(t)})},this.addScriptToPage=function(t){return new Promise(function(e,n){if(r.scriptOnPage(t))return e();var i=document.createElement("script");i.crossOrigin="anonymous",i.onload=function(){return e()},i.onerror=function(){return n()},i.async=!1,i.src=t,document.head.appendChild(i)})},this.addStyleToPage=function(t){var e=document.createElement("link");e.href=t,e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)},this.time=function(t){r.verbose&&console.time(t)},this.timeEnd=function(t){r.verbose&&console.timeEnd(t)},this.account=o,this.workspace=s,this.path=u,this.locale=c||"en-US",this.verbose=l,this.timeout=d,this.publicEndpoint=a||(/myvtexdev\.com/.test(window.location.hostname)?"myvtexdev.com":"myvtex.com"),this.get=window.$?function(t){return window.$.ajax({url:t,timeout:r.timeout}).retry({timeout:2e3,times:2})}:window.fetch?function(t){return new Promise(function(e,n){var i=setTimeout(function(){n({error:"timeout"})},r.timeout);window.fetch(t).then(function(t){return clearTimeout(i),t}).then(function(t){return t.json()}).then(function(t){return e(t)})})}:null,window.__RUNTIME__||(window.__RUNTIME__={account:o,workspace:s,publicEndpoint:a}),!this.get)throw new Error("Render Extension Loader requires either jQuery.ajax or window.fetch.")}}()});
//# sourceMappingURL=render-extension-loader.min.js.map
